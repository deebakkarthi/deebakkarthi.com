---
title: Pig
date: 2023-10-31T06:33:05-04:00
---

# Loading Data
```pig
tips_json_parsing = LOAD '/user/hduser/yelp/tip.json' USING JsonLoader('user_id:chararray, business_id:chararray, text: chararray, data: chararray, compliment_count:int');
```

# Number of comments by each user
```pig
group_user = GROUP tips_json_parsing  BY user_id;
tmp = FOREACH group_user GENERATE group, COUNT(tips_json_parsing);
dump tmp;
```
![Pasted image 20231031144013](../assets/Pasted%20image%2020231031144013.png)

# User with the most comments
```pig
tmp2 = ORDER tmp by $1
```
![Pasted image 20231031144252](../assets/Pasted%20image%2020231031144252.png)

# User with most compliments
```pig
group_user = GROUP tips_json_parsing  BY user_id;
tmp = FOREACH group_user GENERATE (tips_json_parsing.compliment_count, SUM(tips_json_parsing.compliment_count));
tmp2 = ORDER tmp BY $0;
dump tmp2;
```

![Pasted image 20231031145139](../assets/Pasted%20image%2020231031145139.png)

# Restaurant with the most compliments
```pig
group_user = GROUP tips_json_parsing  BY business_id;
tmp = GROUP tips_json_parsing BY business_id;
tmp2 = FOREACH tmp GENERATE group, COUNT(tips_json_parsing.compliment_count);
tmp2 = ORDER tmp2 by $1;
dump tmp2
```
![Pasted image 20231031150125](../assets/Pasted%20image%2020231031150125.png)

# Each restaurant's most reviewed day
```pig
date_split_data = FOREACH tips_json_parsing GENERATE user_id, business_id, compliment_count, text, FLATTEN(STRSPLIT(data, ' ', 2)) AS (date:chararray, time:chararray);
group_data = GROUP date_split_data BY (business_id, date);
tmp = FOREACH group_data GENERATE group, COUNT(date_split_data.time);
tmp2 = ORDER tmp BY $1;
```

![Pasted image 20231031160221](../assets/Pasted%20image%2020231031160221.png)